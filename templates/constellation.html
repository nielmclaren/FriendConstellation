{% extends "base.html" %}

{% block content %}

	<div id="fb-root"></div>
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
				<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</a>

				<div class="nav-collapse collapse">
					<ul class="nav">
						<li class="dropdown">
							<a id="friendListToggle" class="dropdown-toggle" data-toggle="dropdown" href="#">Jump&nbsp;to&nbsp;<b class="caret"></b></a>
							<ul id="friendList" class="dropdown-menu" role="menu" aria-labeledby="friendListToggle">
							</ul>
						</li>
					</ul>

					<ul class="nav pull-right">
						<li class="pull-right"><a href="javascript:FB.logout(function() {window.location='/';});">Logout</a></li>
					</ul>
					<p class="navbar-text pull-right"><strong>{{user.name}}</strong></p>
				</div><!--/.nav-collapse -->
		</div>
	</div>

	<div id="constellation"></div>
	<div id="footer">
		<div class="content">
			<div class="navbar">
				<ul class="nav nav-pills dropup">
					<li class="dropdown">
						<a class="dropdown-toggle" data-toggle="dropdown" href="#">Statistics</a>
						<ul class="dropdown-menu" role="menu">
							<li><a href="#">Friends</a></li>
							<li><a href="#">Mutual friends</a></li>
							<li><a href="#">Social connectors</a></li>
						</ul>
					</li>
				</ul>
				<div id="spacer"></div>
				<ul class="nav nav-pills dropup">
					<li class="dropdown">
						<a class="dropdown-toggle" data-toggle="dropdown" href="#">Hometown</a>
						<ul class="dropdown-menu" role="menu">
							<li><a href="#">Vancouver, Canada <span class="muted">(12 friends)</span></a></li>
							<li><a href="#">Edmonton, Canada <span class="muted">(9 friends)</span></a></li>
							<li><a href="#">Cairo, Egypt <span class="muted">(1 friend)</span></a></li>
						</ul>
					</li>
				</ul>
				<ul class="nav nav-pills dropup">
					<li class="dropdown">
						<a class="dropdown-toggle" data-toggle="dropdown" href="#">Current City</a>
						<ul class="dropdown-menu" role="menu">
							<li><a href="#">Vancouver, Canada <span class="muted">(12 friends)</span></a></li>
							<li><a href="#">Edmonton, Canada <span class="muted">(9 friends)</span></a></li>
							<li><a href="#">Cairo, Egypt <span class="muted">(1 friend)</span></a></li>
						</ul>
					</li>
				</ul>
				<ul class="nav nav-pills dropup">
					<li class="dropdown">
						<a class="dropdown-toggle" data-toggle="dropdown" href="#">Jobs</a>
						<ul class="dropdown-menu" role="menu">
							<li><a href="#">UBC <span class="muted">(12 friends)</span></a></li>
							<li><a href="#">Chalk Media <span class="muted">(11 friends)</span></a></li>
							<li><a href="#">Vision Critical <span class="muted">(8 friends)</span></a></li>
							<li><a href="#">United Nations <span class="muted">(8 friends)</span></a></li>
						</ul>
					</li>
				</ul>
				<ul class="nav nav-pills dropup">
					<li class="dropdown">
						<a class="dropdown-toggle" data-toggle="dropdown" href="#">Sex</a>
						<ul class="dropdown-menu" role="menu">
							<li><a href="#">Male <span class="muted">(48 friends)</span></a></li>
							<li><a href="#">Female <span class="muted">(51 friends)</span></a></li>
						</ul>
					</li>
				</ul>
				<ul class="nav nav-pills dropup">
					<li class="dropdown">
						<a class="dropdown-toggle" data-toggle="dropdown" href="#">Political views</a>
						<ul class="dropdown-menu" role="menu">
							<li><a href="#">Liberal <span class="muted">(33 friends)</span></a></li>
							<li><a href="#">Very Liberal <span class="muted">(28 friends)</span></a></li>
							<li><a href="#">Conservative <span class="muted">(22 friends)</span></a></li>
						</ul>
					</li>
				</ul>
				<ul class="nav nav-pills dropup">
					<li class="dropdown">
						<a class="dropdown-toggle" data-toggle="dropdown" href="#">Religious views</a>
						<ul class="dropdown-menu" role="menu">
							<li><a href="#">Atheist <span class="muted">(43 friends)</span></a></li>
							<li><a href="#">Christian <span class="muted">(28 friends)</span></a></li>
							<li><a href="#">Pastafarian <span class="muted">(12 friends)</span></a></li>
						</ul>
					</li>
				</ul>
				<ul class="nav nav-pills dropup">
					<li class="dropdown">
						<a class="dropdown-toggle" data-toggle="dropdown" href="#">Age</a>
						<ul class="dropdown-menu" role="menu">
							<li><a href="#">0-20 <span class="muted">(7 friends)</span></a></li>
							<li><a href="#">20-30 <span class="muted">(23 friends)</span></a></li>
							<li><a href="#">30-40 <span class="muted">(20 friends)</span></a></li>
							<li><a href="#">40-50 <span class="muted">(12 friends)</span></a></li>
							<li><a href="#">50-60 <span class="muted">(4 friends)</span></a></li>
							<li><a href="#">60+ <span class="muted">(0 friends)</span></a></li>
						</ul>
					</li>
				</ul>
				<ul class="nav nav-pills dropup">
					<li class="dropdown">
						<a class="dropdown-toggle" data-toggle="dropdown" href="#">Relationship status</a>
						<ul class="dropdown-menu" role="menu">
							<li><a href="#">Single <span class="muted">(36 friends)</span></a></li>
							<li><a href="#">Married <span class="muted">(16 friends)</span></a></li>
							<li><a href="#">Engaged <span class="muted">(2 friends)</span></a></li>
							<li><a href="#">In a relationship <span class="muted">(32 friends)</span></a></li>
							<li><a href="#">It's complicated <span class="muted">(1 friend)</span></a></li>
						</ul>
					</li>
				</ul>
			</div>
		</div>
	</div>
	<script type="text/javascript">

		var constellation;
		var prevSelectedNodeId;
		var initConstellation = function() {
			var config = {
						 id: 'constellation',
						 graphLoaderClass: SimpleGraphLoader,
						 graphLoader: {
										 url: '/chart/{{chart.id}}/data'
						 },
						 graphParserClass: CustomGraphParser,
						 graphViewClass: DirectGraphView,
						 layoutClass: CustomLayout
			};
			var styles = [
						 ['node', {
										 rendererClass: CustomNodeRenderer
						 }],
						 ['edge', {
										 rendererClass: DefaultEdgeRenderer
						 }]
			];

			constellation = new Constellation(config, styles);
			$(constellation)
				.bind('log', function(event, severity, message) {
					var args = Array.prototype.slice.call(arguments, 2);
					switch (severity) {
						case 'debug':
							//window.console.debug.apply(window.console, args);
							break;
						case 'warn':
							window.console.warn.apply(window.console, args);
							break;
						case 'error':
							window.console.error.apply(window.console, args);
							break;
					}
				})
				.bind('nodeclick', function(event, nodeId) {
					constellation.setSelectedNodeId(nodeId);
				})
				.bind('nodeselect', function(event, nodeId) {
					var n;
					if (prevSelectedNodeId) {
						n = constellation.getNode(prevSelectedNodeId);
						if (n) {
							n.data.selected = false;
							n.draw();
						}
					}

					n = constellation.getNode(nodeId);
					if (n) {
						n.data.selected = true;
						n.draw();
					}

					prevSelectedNodeId = nodeId;
				})
				.bind('click', function(event) {
					constellation.setSelectedNodeId(null);
				});

			constellation.init();
			
			FB.getLoginStatus(function(response) {
				if (response.status === 'connected') {
					FB.api('/me/friends', function(response) {
						if (response.data) {
							response.data.sort(function(a,b) { return a.name < b.name ? -1 : a.name > b.name ? 1 : 0; });
							$.each(response.data, function(i, d) {
								$('#friendList').append(
									"<li><a href=\"javascript:constellation.setSelectedNodeId('" + d.id + "');\">"
									+ d.name + '</a></li>');
							});
						}
					});
				}
				else {
					window.location = '/';
				}
			});
		}

	</script>

{% endblock %}
